services:
  # [1] 백엔드 서비스 (Spring Boot)
  backend:
    # GitHub Container Registry 주소를 추가합니다.
    image: ghcr.io/migong0311/sm-osh-company-website-backend:latest
    build: ./backend
    container_name: safety-backend
    ports:
      - "8080:8080"
    environment:
      - SPRING_DATASOURCE_URL=jdbc:mysql://db:3306/ssafit?serverTimezone=Asia/Seoul&characterEncoding=UTF-8&useSSL=false
      - SPRING_DATASOURCE_USERNAME=root
      - SPRING_DATASOURCE_PASSWORD=ssafit_password
      - SPRING_DATASOURCE_DRIVER_CLASS_NAME=com.mysql.cj.jdbc.Driver
    depends_on:
      - db
    networks:
      - app-network

  # [2] 프론트엔드 서비스 (Vue.js + Nginx)
  frontend:
    # GitHub Container Registry 주소를 추가합니다.
    image: ghcr.io/migong0311/sm-osh-company-website-frontend:latest
    build: ./frontend
    container_name: safety-frontend
    networks:
      - app-network

  # [3] 데이터베이스 서비스 (MySQL)
  db:
    image: mysql:8.0
    container_name: safety-db
    restart: always
    environment:
      MYSQL_DATABASE: ssafit
      MYSQL_ROOT_PASSWORD: ssafit_password
      TZ: Asia/Seoul
    command: 
      - --character-set-server=utf8mb4
      - --collation-server=utf8mb4_unicode_ci
    volumes:
      - mysql_data:/var/lib/mysql
    networks:
      - app-network

  # [4] 메인 게이트웨이 (Nginx)
  nginx-gateway:
    image: nginx:latest
    container_name: safety-gateway
    ports:
      - "80:80"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
    depends_on:
      - frontend
      - backend
    networks:
      - app-network

volumes:
  mysql_data:

networks:
  app-network:
    driver: bridge